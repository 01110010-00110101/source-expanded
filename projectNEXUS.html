<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Loader</title>
  <style>
    body { 
      background:#111; 
      color:white; 
      font-family:Arial; 
      display:flex; 
      justify-content:center; 
      align-items:center; 
      height:100vh;
    }
    button {
      font-size:20px;
      padding:15px 30px;
      cursor:pointer;
    }
  </style>
</head>
<body>

<button id="openBtn">Open WannaSmile in about:blank</button>

<script>
document.getElementById("openBtn").onclick = async () => {

  const cdnRoot = "https://cdn.jsdelivr.net/gh/wanna5mile/wanna5mile.github.io@main/";

  // 1. Fetch index.html
  let html = await fetch(cdnRoot + "index.html").then(r => r.text());

  // 2. Rewrite all src/href values to CDN absolute paths
  html = html.replace(/(src|href)="(?!https?:\/\/)([^"]+)"/g,
    (m, attr, path) => `${attr}="${cdnRoot}${path}"`);

  // 3. Open a blank tab FIRST
  const win = window.open("about:blank");

  // 4. Write the HTML into that window
  win.document.open();
  win.document.write(html);
  win.document.close();

  // 5. Add the link interceptor AFTER the DOM loads inside the new window
  win.onload = () => {

    const interceptor = `
      (function() {
        function openInEmbed(url) {
          const tab = window.open("about:blank");
          tab.document.write(\`
            <html><body style="margin:0;overflow:hidden;">
              <embed src="\${url}" style="position:absolute;top:0;left:0;width:100vw;height:100vh;border:none;">
            </body></html>
          \`);
          tab.document.close();
        }

        // Intercept normal <a> clicks
        document.addEventListener("click", e => {
          const a = e.target.closest("a");
          if (!a) return;
          e.preventDefault();
          openInEmbed(a.href);
        });

        // Intercept window.open calls
        window.open = url => {
          openInEmbed(url);
          return null;
        };
      })();
    `;

    // Attach script into the opened window
    const s = win.document.createElement("script");
    s.textContent = interceptor;
    win.document.body.appendChild(s);
  };
};
</script>

</body>
</html>
